let JFieldSingleValues=false;function initJFields(){let e=document.getElementsByClassName("JField");Array.from(e).forEach(e=>{initJField(e)})}function initJField(e){StartContainerContent(e)}function CreateJFieldElement(t,l,e){if(t==null&&l==null){console.error("FIELDS: Needs parent element and ID");return}let n=createElement("div","JField",{attr:"id",value:l});t.appendChild(n);if(e==null){let e=createElement("input",undefined,[{attr:"type",value:"hidden"},{attr:"data-JFieldID",value:l}]);t.appendChild(e)}StartContainerContent(n)}function StartContainerContent(e){let t=CreateJFieldContainer();let l=CreateJField();let n=AddColumnOptions();t.append(l);t.append(n);e.append(t)}function CreateJField(e){let t=createElement("div","row JField-Div JField-Div-Value",{attr:"data-JFieldType",value:"JFieldValue"});let l=KeyValuePairButton();let n=createElement("input","JField-Row",[{attr:"data-JFieldType",value:"Input"},{attr:"placeholder",value:"value"}]);if(e!==undefined)n.value=e;n.addEventListener("keyup",function(e){let t=GetThisJFieldFormElement(e);if(ResultsContainerExist(t.getAttribute("id")))ShowResults(GetResultsContainer(t),CreateJsonObject(t))});t.append(n);t.append(l);return t}function CreateKeyValuePairField(){let e=createElement("div","row JField-Div JField-Div-KeyValue",{attr:"data-JFieldType",value:"KeyValue"});let t=createElement("div","col JField-Div",{attr:"data-JFieldType",value:"JFieldProperty"});let l=createElement("input","JField-Row row",[{attr:"data-JFieldType",value:"Input"},{attr:"placeholder",value:"Property Name"}]);l.addEventListener("keyup",function(e){let t=GetThisJFieldFormElement(e);if(ResultsContainerExist(t.getAttribute("id")))ShowResults(GetResultsContainer(t),CreateJsonObject(t))});t.append(l);let n=CreateJFieldContainer();let i=createElement("div","col JField-Div",{attr:"data-JFieldType",value:"JFieldValue"});l=createElement("input","row JField-Row",[{attr:"data-JFieldType",value:"Input"},{attr:"placeholder",value:"Value"}]);l.addEventListener("keyup",function(e){let t=GetThisJFieldFormElement(e);if(ResultsContainerExist(t.getAttribute("id")))ShowResults(GetResultsContainer(t),CreateJsonObject(t))});let r=KeyValuePairButton();let a=AddColumnOptions();i.append(l);i.append(r);i.append(new ArraySingleSwapButton("[]"));n.append(i);n.append(a);e.append(t);e.append(n);return e}function CreateJFieldContainer(){return createElement("div","col JFieldContainer-Div array-container no-gutters",[{attr:"data-jfieldtype",value:"array-container"}])}function KeyValuePairButton(){let e=createElement("button","JField-KeyValuePair-button",[{attr:"type",value:"button"}]);e.innerHTML="KVP";e.addEventListener("click",OnJFieldKeyValuePairClick);e.addEventListener("keyup",CreateJsonObject);return e}function AddColumnOptions(){let e=createElement("div","row",[{attr:"data-jfieldtype",value:"ColumnOptions"}]);let t=AddValueButton();let l=AddRemoveButton();e.append(t);e.append(l);return e}function AddValueButton(){let e=createElement("button","JField-value-button col",[{attr:"type",value:"button"}]);e.innerHTML="+";e.addEventListener("click",OnAddValueClick);return e}function AddRemoveButton(){let e=createElement("button","JField-value-button col",[{attr:"type",value:"button"}]);e.innerHTML="-";e.addEventListener("click",OnRemoveValueClick);return e}function ArraySingleSwapButton(e){let t=createElement("button","JField-ArraySingleSwap-button",{attr:"type",value:"button"});if(e==="[]"){t.value="[]";t.innerHTML="[ ]"}else{t.value="str";t.innerHTML='""'}t.addEventListener("click",function(){new OnJFieldArraySingleSwap(this,t.value)});return t}function createElement(e,t,l){let n=document.createElement(e);addClassNames(n,t);addAttributes(n,l);return n}function addClassNames(t,l){if(l!==undefined){if(l.includes(" "))if(l.indexOf(" ")>=0){l=l.split(" ")}if(Array.isArray(l)){for(let e=l.length-1;e>=0;e--){t.classList.add(l[e])}}else{t.classList.add(l)}}return t}function addAttributes(t,l){if(l!==undefined){if(Array.isArray(l)){for(let e=l.length-1;e>=0;e--){t.setAttribute(l[e].attr,l[e].value)}}else{t.setAttribute(l.attr,l.value)}}return t}function CreateJsonObject(e){if(e===undefined||e===null)e=document.getElementsByClassName("JField")[0];return ConvertHTMLToJason(e)}function ShowResults(e,t){SetResultToInput(e,t);e.innerHTML=JSON.stringify(t.length>1?t:t[0])}function SetResultToInput(e,t){if(e.hasAttribute("type"))e.value=t}function JsonToForm(e,t){let l=document.getElementById(e);if(l===null){console.error("JFIELDS: The form: "+e+" was not found.");return}let n=l.childNodes[0];n.innerHTML="";n.appendChild(AddColumnOptions());if(Object.keys(t).length>0&&t.constructor===Object&&thisArray.length===0){}else if(t.length>0){for(let e=0;e<t.length;e++){CreateFieldFromJsonData(n,t[e])}}for(let e=0;e<n.childNodes.length;e++){if(CheckElementForJFieldType(n.childNodes[e],"JFieldValue")&&CheckElementForJFieldType(n.childNodes[e].childNodes[0],"KeyValue"))n.childNodes[e].classList.remove("row")}ShowResults(GetResultsContainer(l),CreateJsonObject(l))}function RetrievePropertyName(l){for(let e=0;e<l.childNodes.length;e++){let t=l.childNodes[e];if(CheckElementForJFieldType(t,"Input")){return t.value}else{let e=RetrievePropertyName(t);if(e!=null){return e}}}}function GetValuesFromArrayContainer(l){let n=[];let i={};let r=true;let e=l.childNodes[0].hasAttribute("data-jfieldarray");let a=GetJFieldElements(l.childNodes);for(let l=0;l<a.length;l++){let e=a[l];if(e.childNodes.length===0)continue;let t=e.childNodes[0];if(!CheckElementForJFieldType(t,"KeyValue"))r=false}for(let t=0;t<l.childNodes.length;t++){if(!r)i={};let e=l.childNodes[t];if(CheckElementForJFieldType(e,"JFieldValue")){let t=e.childNodes[0];if(CheckElementForJFieldType(t,"KeyValue")){let e=RetrievePropertyName(t);i[e]=GetValuesFromArrayContainer(t.childNodes[1]);if(!r){n.push(i)}}else{n.push(e.childNodes[0].value)}}}if(Object.keys(i).length>0&&i.constructor===Object&&n.length===0)return i;if(n.length===1&&!e)return n[0];return n.length>0?n:i}function GetJFieldElements(l){let n=[];for(let t=0;t<l.length;t++){let e=l[t];if(e.hasAttribute("data-jfieldtype")&&e.getAttribute("data-jfieldtype")!=="ColumnOptions")n.push(e)}return n}function CheckElementForJFieldType(e,t){return e.hasAttribute("data-jfieldtype")&&e.getAttribute("data-jfieldtype")===t}function GetArrayOfAllValues(t){let l=[];for(let e=0;e<t.childNodes.length;e++){if(t.childNodes[e].getAttribute("data-jfieldtype")==="JFieldValue"){l.push(t.childNodes[e])}}return l}function DetermineValueType(e){if(e.constructor===Object)return"object";else if(Array.isArray(e))return"Array";else return"Value"}function CreateFieldFromJsonData(r,a){let d=DetermineValueType(a);switch(d){case"Value":let e=CreateJField();SetJFieldData(e,a);let t=r.childNodes.length;r.insertBefore(e,r.childNodes[t-1]);break;case"Array":console.log(d+" | "+a);for(let l=0;l<a.length;l++){let e=CreateJField();SetJFieldData(e,a[l]);let t=r.childNodes.length;e.setAttribute("data-jfieldarray","");r.insertBefore(e,r.childNodes[t-1])}break;case"object":let l=CreateJField();l.innerHTML="";let n=new CreateKeyValuePairField;let i=n.childNodes[1];i.innerHTML="";i.append(AddColumnOptions());if(Object.entries(a).length===1){for(const[o,u]of Object.entries(a)){SetJFieldData(n,"",o);CreateFieldFromJsonData(i,u);l.append(n)}r.insertBefore(l,r.childNodes[r.childNodes.length-1])}else{for(const[o,u]of Object.entries(a)){l=CreateJField();l.innerHTML="";l.classList.remove("row");n=new CreateKeyValuePairField;i=n.childNodes[1];i.innerHTML="";SetJFieldData(n,"",o);l.append(n);CreateFieldFromJsonData(i,u);r.insertBefore(l,r.childNodes[r.childNodes.length-1])}}break}}function SetJFieldData(t,l,n){if(CheckElementForJFieldType(t,"JFieldValue")){t.childNodes[0].value=l}else if(CheckElementForJFieldType(t,"KeyValue")&&n!==""){let e=t.childNodes[0];e.childNodes[0].value=n}else if(CheckElementForJFieldType(t,"KeyValue")&&l!==""){let e=t.childNodes[1];e.childNodes[0].childNodes[0].value=l}}function ConvertHTMLToJason(t){if(!t.classList.contains("JField")){console.error('FIELDS: You need to pass in the top level form element ".JField"');return}let l=[];for(let e=0;e<t.childNodes.length;e++)l.push(GetValuesFromArrayContainer(t.childNodes[e]));return l}function GetThisJFieldFormElement(t){if(t===undefined||t==null)return document.getElementsByClassName("JField")[0];let n="";if(t["path"]!==undefined){let l=t["path"];for(let t=0;t<l.length;t++){let e=l[t];if(e.classList!==undefined&&e.classList.contains("JField")){n=e.getAttribute("id");break}}}if(t.parentElement!=null){let e=t;while(n===""){if(e.classList!==null&&e.classList.contains("JField"))n=e.getAttribute("id");e=e.parentElement;if(e.tagName==="BODY")break}}if(n===""||n===null)return document.getElementsByClassName("JField")[0];return document.getElementById(n)}function ResultsContainerExist(e){return!!(document.querySelector("#JFieldResult")||document.querySelector('*[data-JFieldID="'+e+'"]'))}function GetResultsContainer(e){let t=e.getAttribute("id");if(t!==null){return document.querySelector('*[data-JFieldID="'+t+'"]')}else if(document.getElementById("JFieldResult")){return document.getElementById("JFieldResult")}}function OnJFieldKeyValuePairClick(){let e=CreateKeyValuePairField();let t=this.parentElement;e.childNodes[0].childNodes[0].value=t.childNodes[0].value;t.classList.remove("row");this.parentElement.innerHTML="";t.append(e)}function OnJFieldArraySingleSwap(e,t){let l=e.parentElement;if(t==="[]"){l.setAttribute("data-JFieldArray","");e.value="str";e.innerHTML='""'}else{l.removeAttribute("data-JFieldArray");e.value="[]";e.innerHTML="[]"}let n=GetThisJFieldFormElement(l);if(ResultsContainerExist(n.getAttribute("id")))ShowResults(GetResultsContainer(n),CreateJsonObject(n))}function OnAddValueClick(){let e=CreateJField();let t=this.parentElement.parentElement;let l=t.childNodes.length;t.insertBefore(e,t.childNodes[l-1]);CreateJsonObject()}function OnRemoveValueClick(){let e=GetThisJFieldFormElement(this);let t=this.parentElement;let l=t.parentElement;let i=l.parentElement;let n=i.querySelector('div[data-jfieldtype="JFieldProperty"] input');let r;if(n!==null)r=n.value;let a=GetArrayOfAllValues(l);let d=a.length;if(d>0){if(d===1){if(i.getAttribute("data-jfieldtype")==="KeyValue"){let e=i.parentElement;e.classList.add("row");i.remove();let t=CreateJField(r);let l=KeyValuePairButton();let n=e.hasAttribute("data-jfieldarray")?"str":"[]";e.append(t.childNodes[0]);e.append(l);e.append(new ArraySingleSwapButton(n))}}else{a[a.length-1].remove()}CreateJsonObject()}if(ResultsContainerExist(e.getAttribute("id")))ShowResults(GetResultsContainer(e),CreateJsonObject(e))}